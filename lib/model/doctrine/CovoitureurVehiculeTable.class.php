<?php

/**
 * CovoitureurVehiculeTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class CovoitureurVehiculeTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object CovoitureurVehiculeTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('CovoitureurVehicule');
    }

    //filtrage des vehicules pour un  covoitureur et en fonction du site (id_site)

    public function getVehiculeCovoitureur($id_utilisateur) {
        $q = Doctrine_Query::create()
                //->select('id_vehicule')
                ->from('CovoitureurVehicule cv')
                ->where('id_utilisateur = ?', $id_utilisateur)
                //->andWhere('id_site = ?', sfConfig::get('sf_id_site_client'))
                        ;

        return $q;
    }
    
    public static function getCarsOfUser($id_utilisateur) {
        return Doctrine_Query::create()
                ->from('CovoitureurVehicule cv')
                ->where('id_utilisateur = ?', $id_utilisateur)
                ->execute();
    }

    /*
     * récupération de l'id vehicule si il existe pour un covoitureur 
     */

    public function getCovoitureurVehicule($id_utilisateur = null, $id_marque = null, $id_modele = null) {
        if ($id_utilisateur == null || $id_marque == null || $id_modele == null) {
            return 0;
        }

        $qt = Doctrine_Query::create()
                ->select('id_vehicule')
                ->from('CovoitureurVehicule cv')
                ->where('cv.etat = 1 ')
                ->andWhere('cv.id_marque = ?', $id_marque)
                ->andWhere('cv.id_modele = ?', $id_modele)
                ->andWhere('cv.id_utilisateur = ?', $id_utilisateur)
        ;



        $vehicule = $qt->fetchOne();
        //$vehicule = $qt->execute();

        if ($vehicule) {
            //return $vehicule[0]['id_vehicule'];
            return $vehicule['id_vehicule'];
            //return $vehicule->getIdVehicule();
        } else {
            return 0;
        }

        // return $vehicule[0]['id_vehicule'];
    }

}